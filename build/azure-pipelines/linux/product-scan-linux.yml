steps:
- task: CredScan@2
  inputs:
    toolMajorVersion: 'V2'
- task: NodeTool@0
  inputs:
    versionSpec: "12.14.1"

- task: geeklearningio.gl-vsts-tasks-yarn.yarn-installer-task.YarnInstaller@2
  inputs:
    versionSpec: "1.x"

- script: |
    set -e
    CHILD_CONCURRENCY=1 npm_config_arch=$(NPM_ARCH) yarn --frozen-lockfile
  displayName: Install dependencies

- script: |
    set -e
    yarn gulp vscode-symbols-linux-x64
  displayName: Download Symbols

- task: BinSkim@3
  inputs:
    toolVersion: Latest
    InputType:   CommandLine
    arguments:   analyze $(agent.builddirectory)\scanbin\**\electron $(agent.builddirectory)\scanbin\*.node $(agent.builddirectory)\scanbin\*.so --recurse

- task: TSAUpload@1
  inputs:
    tsaVersion: 'TsaV2'
    codebase: 'NewOrUpdate'
    tsaEnvironment: 'PROD'
    serviceTreeID: '79c048b2-322f-4ed5-a1ea-252a1250e4b3'
    codeBaseName: 'vscode-client'
    notificationAlias: 'sbatten@microsoft.com'
    notifyAlwaysV2: true
    codeBaseAdmins: 'REDMOND\stbatt'
    instanceUrlForTsaV2: 'MSAZURE'
    projectNameMSAZURE: 'One'
    areaPath: 'One\VSCode\Client'
    uploadAPIScan: false
    uploadBinSkim: true
    uploadCredScan: true
    uploadFortifySCA: false
    uploadFxCop: false
    uploadModernCop: false
    uploadPoliCheck: false
    uploadPREfast: false
    uploadRoslyn: false
    uploadTSLint: false
    uploadAsync: true
